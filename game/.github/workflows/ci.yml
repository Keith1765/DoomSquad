name: Rust Pull Request Checks – Build, Format, Test & Clippy

# ============================================================
# Summary of fulfilled requirements (based on SEP project list)
#
# Git Requirements:
#   ✔ (G6) At least two server-side quality gates for pull requests
#
# Code Requirements:
#   ✔ (C1) Project compiles with stable Rust (cargo build)
#   ✔ (C3) No compiler warnings (RUSTFLAGS = "-Dwarnings")
#   ✔ (C4) Proper formatting (cargo fmt --check)
#   ✔ (C5) No Clippy warnings (cargo clippy -D warnings)
#   ✔ (C8) Sensible testing method (cargo test)
#
# Additional benefits:
#   • Ensures code quality before merging into main
#   • Helps keep main branch clean and always compilable
# ============================================================

# This workflow runs automatically whenever someone opens
# or updates a Pull Request targeting the main branch.
on:
  pull_request:
    branches: [ "main" ]

jobs:
  rust-quality-checks:
    # Use a fresh Ubuntu machine to run all steps.
    runs-on: ubuntu-latest

    # Enforce all Rust compiler warnings as errors (C3 requirement)
    env:
      RUSTFLAGS: "-Dwarnings"

    steps:

      # 1) Download the project code so the following steps can access it.
      - name: Download project code (Checkout)
        uses: actions/checkout@v4

      # 2) Install the Rust toolchain (stable channel)
      #    so that cargo and rustc are available.
      - name: Install Rust (stable toolchain)
        uses: dtolnay/rust-toolchain@stable

      # 3) Ensure code is formatted according to Rust style guidelines.
      #    "--check" means it will fail CI if formatting is incorrect.
      - name: Check Rust formatting (cargo fmt)
        run: cargo fmt --all -- --check

      # 4) Run a quick type-check to catch issues early.
      - name: Type check the project (cargo check)
        run: cargo check --all --verbose

      # 5) Build the Rust project to verify that the code compiles correctly.
      - name: Build the Rust project (cargo build)
        run: cargo build --verbose

      # 6) Run the project's tests (even minimal tests fulfill requirement C8).
      - name: Run tests
        run: cargo test --all --verbose

      # 7) Run Clippy (Rust's linter) to check for issues in the code.
      #    "-D warnings" makes any warning count as an error,
      #    which prevents merging if the code is not clean.
      - name: Run Clippy to ensure clean, warning-free code
        run: cargo clippy --all -- -D warnings
